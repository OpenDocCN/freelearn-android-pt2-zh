# 前言

本书介绍了针对 Android 开源项目的安全增强（SE），并引导您通过使用 SE for Android 保护新嵌入式系统的过程。据我们所知，本书是第一个完整记录这一过程的来源，以便学生、DIY 爱好者以及工程师可以创建由 SE for Android 保护的定制系统。通常，只有原始设备制造商（OEM）会这样做，而且通常目标设备是手机或平板电脑。我们真心希望我们的书能改变这一点，让更广泛的受众参与开发，使他们能够使用和理解这些现代安全工具。

我们非常努力地确保这本书不仅仅是一本按部就班的技术书籍。特别是，我们选择了一个模式，指导您通过失败走向成功。您首先会对如何获得和执行安全性有适当的理论了解。然后，我们将介绍一个从未以这种方式保护过的系统（甚至在我们编写这本书之前，我们也没有这样做过）。接下来，我们会引导您完成我们所有的智能猜测工作，接受因新发现的特性而导致的意外失败，并最终执行我们的自定义安全策略。这需要您学会解决诸如 SELinux、SE for Android 和 Google Android 等主要开源项目之间的差异，这些项目各有独立的目标和部署计划。这为您保护其他设备做好准备，这个过程总是不同的，但希望现在能更容易实现。

# 本书涵盖的内容

第一章，*Linux 访问控制*，讨论了自主访问控制（DAC）的基础知识，一些 Android 漏洞如何利用 DAC 问题，并展示了需要更强大解决方案的需求。

第二章，*强制访问控制和 SELinux*，检查强制访问控制（MAC）及其在 SELinux 中的体现。这一章还探讨了具体的策略来控制 SELinux 对象交互。

第三章，*Android 的奇妙之处*，介绍了 Android 安全模型，并调查了 binder、zygote 和属性服务。

第四章，*在 UDOO 上的安装*，逐步讲解从源代码构建和部署 Android 到 UDOO 嵌入式主板，并开启 SELinux 支持。

第五章，*启动系统*，从策略加载的角度跟随启动过程，并在 UDOO 上纠正问题，使 SELinux 达到可用状态。

第六章，*探索 SELinuxFS*，检查 SELinuxFS 文件系统以及它是如何为高级别习惯用语提供内核到用户空间的接口。

第七章，*利用审计日志*，研究了审计子系统，揭示了如何解释 SELinux 审计日志以利于策略编写。

第八章，*将上下文应用于文件*，教你如何给文件系统及其对象分配标签和上下文，并展示更改它们的技术，包括动态类型转换。

第九章，*向域添加服务*，强调进程标签，尤其是由 init 运行和管理的 Android 服务。

第十章，*将应用程序放入域中*，教你如何正确地给应用程序的私有数据目录打标签，以及通过配置文件和 SELinux 策略设置应用程序运行时上下文。

第十一章，*标签属性*，演示如何创建并给新属性和现有属性打标签，以及在这样做时可能遇到的异常情况。

第十二章，*掌握工具链*，讲述了控制设备上策略的各种组件是如何实际构建和创建的。这一章回顾了 Android.mk 组件，详细介绍了构建和配置管理核心的工作原理。

第十三章，*进入强制模式*，利用你在前面章节学到的所有技能，来响应来自 CTS 的审计日志，并将 UDO0 置于强制模式。

附录，*开发环境*，引导你完成设置适合你跟随本书所有活动的 Linux 环境的必要步骤。

# 你需要为这本书准备的东西

硬件要求包括：

+   一块 UDO0 嵌入式开发板

+   一张 8GB 的 Mini SD 卡（虽然你可以使用容量更大的卡，但我们不推荐这样做）

+   至少 16GB 的 RAM

+   至少 80GB 的硬盘空间

软件要求包括：

+   一套 Ubuntu 12.04 LTS 桌面系统

+   Oracle JDK 6.0 版本 6u45

+   本书中需要一些额外的 Linux 软件，但这些都已在书中描述，并且可以免费获取。

# 这本书的目标读者

这本书面向那些对 Linux 实现的操作系统概念有一定了解的开发者和工程师。他们可能是希望保护自己 Android 设备创造的爱好者，制造手机的 OEM 工程师，或者是那些 Android 正在增长的领域的工程师。具备 C 语言编程的基本背景将有所帮助。

# 约定

在这本书中，你会发现多种文本样式，这些样式用于区分不同类型的信息。以下是一些样式示例及其含义的解释。

文本中的代码字、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 处理方式将如下所示："现在让我们尝试执行 `hello.txt` 文件，看看会发生什么。"

代码块设置如下： 

```kt
case INTERFACE_TRANSACTION:
{
reply.writeString(DESCRIPTOR);
return true;
}
```

命令行输入或输出将如下所示：

```kt
$ su testuser
Password: 
testuser@ubuntu:/home/bookuser$ 

```

**新术语** 和 **重要词汇** 会以粗体显示。您在屏幕上看到的词，例如菜单或对话框中的，会在文本中以这种方式出现："通过选择 **退出** 来退出配置菜单，直到系统提示您保存新的配置。"

### 注意

警告或重要提示会以如下框中的形式出现。

### 小贴士

技巧和诀窍会以这种方式出现。

# 读者反馈

我们始终欢迎读者的反馈。告诉我们您对这本书的看法——您喜欢或不喜欢什么。读者的反馈对我们很重要，因为它帮助我们开发出您真正能从中获得最大收益的标题。

如果您想要发送一般性反馈，只需发送电子邮件至 `<feedback@packtpub.com>`，并在邮件的主题中提及书籍的标题。

如果您有专业知识的话题，并且有兴趣撰写或为书籍做出贡献，请查看我们的作者指南 [www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

既然您已经拥有了 Packt 的一本书，我们有许多方法可以帮助您充分利用您的购买。

## 下载示例代码

您可以从您的账户 [`www.packtpub.com`](http://www.packtpub.com) 下载您购买的所有 Packt Publishing 书籍的示例代码文件。如果您在其他地方购买了这本书，可以访问 [`www.packtpub.com/support`](http://www.packtpub.com/support) 注册，我们会直接将文件通过电子邮件发送给您。

## 错误更正

尽管我们已经尽力确保内容的准确性，但错误仍然会发生。如果您在我们的书中发现了一个错误——可能是文本或代码中的错误——如果您能向我们报告，我们将不胜感激。这样做，您可以避免其他读者的困扰，并帮助我们改进本书后续版本。如果您发现任何错误更正，请通过访问 [`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，选择您的书籍，点击 **错误更正提交表单** 链接，并输入您的错误更正详情。一旦您的错误更正得到验证，您的提交将被接受，并将错误更正上传到我们的网站或添加到该标题错误更正部分下的现有错误更正列表中。

要查看之前提交的错误更正，请访问 [`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support)，并在搜索字段中输入书籍名称。所需信息将在 **错误更正** 部分下显示。

## 侵权行为

互联网上对版权材料进行盗版是一个所有媒体都面临的持续问题。在 Packt，我们非常重视保护我们的版权和许可。如果您在互联网上以任何形式遇到我们作品的非法副本，请立即提供位置地址或网站名称，以便我们可以寻求补救措施。

如果您有疑似盗版材料的链接，请通过`<copyright@packtpub.com>`联系我们。

我们感谢您帮助保护我们的作者以及我们向您提供有价值内容的能力。

## 问题

如果您对这本书的任何方面有问题，可以通过`<questions@packtpub.com>`联系我们，我们将尽力解决问题。
